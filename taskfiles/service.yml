# ============================================================================
# GENERATED FILE - DO NOT EDIT MANUALLY
# ============================================================================
# Generated by: xplat gen service
# Regenerate with: xplat gen service --force
# Source: https://github.com/joeblew999/xplat
# ============================================================================
#
# Reusable service taskfile for remote inclusion by xplat consumers.
# Consumers include this via: xplat pkg install plat-geo
#
# Provides standardized service management tasks (start, stop, status)
# that work with the geo binary installed by xplat.
# ============================================================================

version: "3"

vars:
  GEO_BIN: '{{ .GEO_BIN | default "geo" }}'
  GEO_PORT: '{{ .GEO_PORT | default "8086" }}'
  GEO_HOST: '{{ .GEO_HOST | default "0.0.0.0" }}'

tasks:
  start:
    desc: Start the plat-geo service
    cmds:
      - '{{ .GEO_BIN }} serve --port {{ .GEO_PORT }} --host {{ .GEO_HOST }}'

  stop:
    desc: Stop the plat-geo service
    cmds:
      - pkill -f "{{ .GEO_BIN }} serve" || true

  status:
    desc: Check if plat-geo service is running
    cmds:
      - |
        if curl -s http://{{ .GEO_HOST | default "127.0.0.1" }}:{{ .GEO_PORT }}/health > /dev/null 2>&1; then
          echo "plat-geo: running on port {{ .GEO_PORT }}"
        else
          echo "plat-geo: not running"
          exit 1
        fi

  health:
    desc: Check plat-geo service health endpoint
    cmds:
      - 'curl -s http://{{ .GEO_HOST | default "127.0.0.1" }}:{{ .GEO_PORT }}/health | jq . || echo "plat-geo: not responding"'

  restart:
    desc: Restart the plat-geo service
    cmds:
      - task: stop
      - task: start
